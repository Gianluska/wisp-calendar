#!/bin/bash

# lvsk calendar - Minimalist aesthetic calendar
# Ultra-clean design with pastel monochromatic palette
#
# Architecture:
#   - Modular design with separated concerns
#   - Clean component-based UI rendering
#   - Clear separation between data, presentation, and logic

# Determine source directory (local development vs installed package)
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
if [ -d "${SCRIPT_DIR}/src" ]; then
    # Running from development directory
    SRC_DIR="${SCRIPT_DIR}/src"
else
    # Running from installed package
    SRC_DIR="/usr/share/lvsk-calendar/src"
fi

# Source all modules in dependency order
source "${SRC_DIR}/config.sh"
source "${SRC_DIR}/utils.sh"
source "${SRC_DIR}/ui/background.sh"
source "${SRC_DIR}/ui/header.sh"
source "${SRC_DIR}/ui/calendar.sh"
source "${SRC_DIR}/ui/footer.sh"
source "${SRC_DIR}/navigation.sh"
source "${SRC_DIR}/input.sh"

# Setup cleanup trap
trap cleanup_terminal EXIT INT TERM

# Main render function
render() {
    if [ $FIRST_RENDER -eq 1 ]; then
        # First render: draw everything including background
        clear
        draw_background
        FIRST_RENDER=0
    fi

    # Move cursor to home position (fast, no clearing)
    tput home

    draw_header
    draw_day_headers
    draw_calendar
    draw_footer
}

# Application entry point
main() {
    setup_terminal
    setup_hyprland
    show_splash

    # Main event loop
    while true; do
        render
        handle_input
    done
}

# Start application
main
